{"ast":null,"code":"\"use strict\";\n\n// Copyright (C) 2016 Dmitry Chestnykh\n// MIT License. See LICENSE file for details.\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n/**\r\n * Package utf8 implements UTF-8 encoding and decoding.\r\n */\nvar INVALID_UTF16 = \"utf8: invalid string\";\nvar INVALID_UTF8 = \"utf8: invalid source encoding\";\n/**\r\n * Encodes the given string into UTF-8 byte array.\r\n * Throws if the source string has invalid UTF-16 encoding.\r\n */\nfunction encode(s) {\n  // Calculate result length and allocate output array.\n  // encodedLength() also validates string and throws errors,\n  // so we don't need repeat validation here.\n  var arr = new Uint8Array(encodedLength(s));\n  var pos = 0;\n  for (var i = 0; i < s.length; i++) {\n    var c = s.charCodeAt(i);\n    if (c < 0x80) {\n      arr[pos++] = c;\n    } else if (c < 0x800) {\n      arr[pos++] = 0xc0 | c >> 6;\n      arr[pos++] = 0x80 | c & 0x3f;\n    } else if (c < 0xd800) {\n      arr[pos++] = 0xe0 | c >> 12;\n      arr[pos++] = 0x80 | c >> 6 & 0x3f;\n      arr[pos++] = 0x80 | c & 0x3f;\n    } else {\n      i++; // get one more character\n      c = (c & 0x3ff) << 10;\n      c |= s.charCodeAt(i) & 0x3ff;\n      c += 0x10000;\n      arr[pos++] = 0xf0 | c >> 18;\n      arr[pos++] = 0x80 | c >> 12 & 0x3f;\n      arr[pos++] = 0x80 | c >> 6 & 0x3f;\n      arr[pos++] = 0x80 | c & 0x3f;\n    }\n  }\n  return arr;\n}\nexports.encode = encode;\n/**\r\n * Returns the number of bytes required to encode the given string into UTF-8.\r\n * Throws if the source string has invalid UTF-16 encoding.\r\n */\nfunction encodedLength(s) {\n  var result = 0;\n  for (var i = 0; i < s.length; i++) {\n    var c = s.charCodeAt(i);\n    if (c < 0x80) {\n      result += 1;\n    } else if (c < 0x800) {\n      result += 2;\n    } else if (c < 0xd800) {\n      result += 3;\n    } else if (c <= 0xdfff) {\n      if (i >= s.length - 1) {\n        throw new Error(INVALID_UTF16);\n      }\n      i++; // \"eat\" next character\n      result += 4;\n    } else {\n      throw new Error(INVALID_UTF16);\n    }\n  }\n  return result;\n}\nexports.encodedLength = encodedLength;\n/**\r\n * Decodes the given byte array from UTF-8 into a string.\r\n * Throws if encoding is invalid.\r\n */\nfunction decode(arr) {\n  var chars = [];\n  for (var i = 0; i < arr.length; i++) {\n    var b = arr[i];\n    if (b & 0x80) {\n      var min = void 0;\n      if (b < 0xe0) {\n        // Need 1 more byte.\n        if (i >= arr.length) {\n          throw new Error(INVALID_UTF8);\n        }\n        var n1 = arr[++i];\n        if ((n1 & 0xc0) !== 0x80) {\n          throw new Error(INVALID_UTF8);\n        }\n        b = (b & 0x1f) << 6 | n1 & 0x3f;\n        min = 0x80;\n      } else if (b < 0xf0) {\n        // Need 2 more bytes.\n        if (i >= arr.length - 1) {\n          throw new Error(INVALID_UTF8);\n        }\n        var n1 = arr[++i];\n        var n2 = arr[++i];\n        if ((n1 & 0xc0) !== 0x80 || (n2 & 0xc0) !== 0x80) {\n          throw new Error(INVALID_UTF8);\n        }\n        b = (b & 0x0f) << 12 | (n1 & 0x3f) << 6 | n2 & 0x3f;\n        min = 0x800;\n      } else if (b < 0xf8) {\n        // Need 3 more bytes.\n        if (i >= arr.length - 2) {\n          throw new Error(INVALID_UTF8);\n        }\n        var n1 = arr[++i];\n        var n2 = arr[++i];\n        var n3 = arr[++i];\n        if ((n1 & 0xc0) !== 0x80 || (n2 & 0xc0) !== 0x80 || (n3 & 0xc0) !== 0x80) {\n          throw new Error(INVALID_UTF8);\n        }\n        b = (b & 0x0f) << 18 | (n1 & 0x3f) << 12 | (n2 & 0x3f) << 6 | n3 & 0x3f;\n        min = 0x10000;\n      } else {\n        throw new Error(INVALID_UTF8);\n      }\n      if (b < min || b >= 0xd800 && b <= 0xdfff) {\n        throw new Error(INVALID_UTF8);\n      }\n      if (b >= 0x10000) {\n        // Surrogate pair.\n        if (b > 0x10ffff) {\n          throw new Error(INVALID_UTF8);\n        }\n        b -= 0x10000;\n        chars.push(String.fromCharCode(0xd800 | b >> 10));\n        b = 0xdc00 | b & 0x3ff;\n      }\n    }\n    chars.push(String.fromCharCode(b));\n  }\n  return chars.join(\"\");\n}\nexports.decode = decode;","map":{"version":3,"names":["INVALID_UTF16","INVALID_UTF8","encode","s","arr","Uint8Array","encodedLength","pos","i","length","c","charCodeAt","exports","result","Error","decode","chars","b","min","n1","n2","n3","push","String","fromCharCode","join"],"sources":["../utf8.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"script"}